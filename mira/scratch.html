<!DOCTYPE html>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body style="overflow: hidden;">
<div id="canvas"  style="overflow: hidden;"></div>
<script src="d3.v5.min.js"></script>
<script type="text/javascript">


    levels = {}
    pg = {}

    d3.csv("project_grant.csv").then(function(data){


        for (i = 0; i < data.length; i++) {
            const row = data[i]
            const key = row["level1"] + row["level2"] + row["level3"]

            // filling the levels variable
            levels[row["level1"]] = {}

            if (row["level2"].length == 0) {
                levels[row["level1"]] = key
            }

            if (row["level2"].length > 0) {
                levels[row["level1"]][row["level2"]] = {}
            }

            if (row["level3"].length == 0) {
                levels[row["level1"]][row["level2"]] = key
            }

            if (row["level3"].length > 0) {
                levels[row["level1"]][row["level2"]][row["level3"]] = key
            }


            // filling the project grants variable
            var base = {"members": [], "pi": [], "blurb_title":"", "blurb":""}

            pg[key] = typeof(pg[key]) == 'undefined' ? base : pg[key];
            console.log(row["macid"])

            pg[key]["members"].push(row["macid"])
            console.log(pg[key]["members"])
            console.log(pg)
            console.log("@@@@@@@@@@@@@@@@@@@@@@@@@@@")

            if (row["pi"] == "TRUE"){
                pg[key]["pi"].push(row["macid"])
            }

            if (row["blurb_title"].length > pg[key]["blurb_title"].length){
                pg[key]["blurb_title"] = row["blurb_title"]
            }

            if (row["blurb"].length > pg[key]["blurb"].length){
                pg[key]["blurb"] = row["blurb"]
            }


        }
        //console.log(pg)
       // console.log(levels)
    })

</script>
</body>
</html>